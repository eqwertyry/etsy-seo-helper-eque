<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Etsy SEO Assistant</title>
<style>
:root {
  --primary-color: #2563eb;
  --primary-hover: #1d4ed8;
  --secondary-color: #64748b;
  --secondary-hover: #475569;
  --success-color: #10b981;
  --error-color: #ef4444;
  --background-color: #f8fafc;
  --surface-color: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --border-color: #e2e8f0;
  --border-radius: 12px;
  --shadow: 0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
  --logo-color: #e11d48;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color: var(--text-primary);
  min-height: 100vh;
  margin:0;
  padding:0;
}
.screen {min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;}
.hidden {display:none !important;}
.activation-card, .input-section, .results-card, .error-card {background:var(--surface-color); border-radius:var(--border-radius); box-shadow:var(--shadow-lg); padding:32px; max-width:400px; margin:0 auto;}
.btn {position:relative; display:inline-flex; align-items:center; justify-content:center; padding:12px 24px; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; transition:0.2s; text-decoration:none; min-height:48px;}
.btn-primary {background:var(--primary-color); color:white;}
.btn-primary:hover:not(:disabled){background:var(--primary-hover); transform:translateY(-1px); box-shadow:var(--shadow-lg);}
.btn-secondary {background:var(--secondary-color); color:white;}
.btn-secondary:hover:not(:disabled){background:var(--secondary-hover);}
.btn:disabled{opacity:0.6; cursor:not-allowed;}
.btn-loader{display:none; width:20px; height:20px; border:2px solid transparent; border-top:2px solid currentColor; border-radius:50%; animation:spin 1s linear infinite; margin-left:8px;}
.btn.loading .btn-text{opacity:0.7;}
.btn.loading .btn-loader{display:block;}
@keyframes spin {to{transform:rotate(360deg);}}
.input-group{margin-bottom:16px;}
.input-group label{display:block;margin-bottom:8px;font-weight:600;}
.input-group input, .input-group textarea{width:100%; padding:12px; border:2px solid var(--border-color); border-radius:8px; font-size:16px; transition:all 0.2s ease;}
.input-group input:focus, .input-group textarea:focus{outline:none; border-color:var(--primary-color); box-shadow:0 0 0 3px rgba(37,99,235,0.1);}
.results-section, .error-section{animation:slideIn 0.3s ease-out;}
@keyframes slideIn {from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);}}
</style>
</head>
<body>

<!-- Activation Screen -->
<div id="activation-screen" class="screen">
  <div class="activation-card">
    <h1 style="color:var(--logo-color)">Etsy SEO Assistant</h1>
    <p>Optimize your products for better visibility</p>
    <div class="input-group">
      <label for="activation-key">Activation Key</label>
      <input type="text" id="activation-key" placeholder="Enter your activation key">
      <div id="activation-error" style="color:var(--error-color); margin-top:8px;"></div>
    </div>
    <button id="activate-btn" class="btn btn-primary">
      <span class="btn-text">Activate</span>
      <div class="btn-loader"></div>
    </button>
  </div>
</div>

<!-- Main Screen -->
<div id="main-screen" class="screen hidden">
  <div style="width:100%; max-width:800px;">
    <header style="display:flex; justify-content:space-between; align-items:center; background:var(--surface-color); padding:16px; border-radius:var(--border-radius); box-shadow:var(--shadow); margin-bottom:24px;">
      <h1 style="color:var(--logo-color)">Etsy SEO Assistant</h1>
      <button id="logout-btn" class="btn btn-secondary">Logout</button>
    </header>
    <div class="input-section">
      <div class="input-group">
        <label for="product-title">Product Title</label>
        <textarea id="product-title" placeholder="Enter your product title for SEO analysis..." rows="3"></textarea>
      </div>
      <button id="analyze-btn" class="btn btn-primary">
        <span class="btn-text">Analyze SEO</span>
        <div class="btn-loader"></div>
      </button>
    </div>
    <div id="results-section" class="results-section hidden">
      <div class="results-card">
        <h2>Analysis Results</h2>
        <div><h3>üìù SEO Score & Analysis</h3><pre id="title-result"></pre></div>
        <div><h3>üè∑Ô∏è Keyword Suggestions</h3><pre id="tags-result"></pre></div>
        <div><h3>üí° Optimization Tips</h3><pre id="tips-result"></pre></div>
      </div>
    </div>
    <div id="error-section" class="error-section hidden">
      <div class="error-card">
        <h3>‚ùå Error</h3>
        <p id="error-message"></p>
        <button id="retry-btn" class="btn btn-secondary">Try Again</button>
      </div>
    </div>
  </div>
</div>

<script>
class EtsySEOAssistant {
  constructor() {
    this.activationApiUrl = 'https://etsy-seo-helper-eque-af7n-git-main-eqwertyry-s-projects.vercel.app/api/analyze';
    this.analyzeApiUrl = 'https://etsy-seo-helper-eque-af7n-git-main-eqwertyry-s-projects.vercel.app/api/analyze-seo';
    this.activationKey = null;
    this.init();
  }

  init() {
    this.bindEvents();
    this.checkActivation();
  }

  bindEvents() {
    document.getElementById('activate-btn').addEventListener('click', ()=>this.handleActivation());
    document.getElementById('activation-key').addEventListener('keypress',(e)=>{if(e.key==='Enter') this.handleActivation();});
    document.getElementById('analyze-btn').addEventListener('click', ()=>this.handleAnalysis());
    document.getElementById('product-title').addEventListener('keypress',(e)=>{if(e.key==='Enter' && e.ctrlKey)this.handleAnalysis();});
    document.getElementById('logout-btn').addEventListener('click', ()=>this.handleLogout());
    document.getElementById('retry-btn').addEventListener('click', ()=>this.handleAnalysis());
  }

  checkActivation() {
    const savedKey = localStorage.getItem('etsy_seo_activation_key');
    if(savedKey){this.activationKey=savedKey; this.showMainScreen();} else {this.showActivationScreen();}
  }

  async handleActivation() {
    const keyInput = document.getElementById('activation-key');
    const activateBtn = document.getElementById('activate-btn');
    const errorDiv = document.getElementById('activation-error');
    const key = keyInput.value.trim();
    if(!key){errorDiv.textContent='Please enter an activation key'; return;}
    this.setButtonLoading(activateBtn,true);
    errorDiv.textContent='';
    try {
      const response = await fetch(this.activationApiUrl,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({key:key})
      });
      const data = await response.json();
      if(response.ok && data.success){   // ‚Üê –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!
        this.activationKey = key;
        localStorage.setItem('etsy_seo_activation_key', key);
        this.showMainScreen();
      } else {
        errorDiv.textContent = data.error || 'Invalid activation key';
      }
    } catch(err){
      console.error('Activation error:',err);
      errorDiv.textContent='Connection failed. Please check your internet connection.';
    } finally {
      this.setButtonLoading(activateBtn,false);
    }
  }

  async handleAnalysis() {
    const productTitle = document.getElementById('product-title').value.trim();
    if(!productTitle){alert('Please enter a product title'); return;}
    this.setButtonLoading(document.getElementById('analyze-btn'), true);
    this.hideResults();
    this.hideError();
    try{
      const response = await fetch(this.analyzeApiUrl,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          key:this.activationKey,
          productTitle: productTitle
        })
      });
      if(!response.ok) throw new Error('Server returned '+response.status);
      const data = await response.json();
      this.displayResults(data);
    } catch(err){
      console.error('Analysis error:',err);
      this.showErrorSection('Failed to analyze product title. Please try again.');
    } finally {
      this.setButtonLoading(document.getElementById('analyze-btn'), false);
    }
  }

  handleLogout(){
    localStorage.removeItem('etsy_seo_activation_key');
    this.activationKey=null;
    this.showActivationScreen();
    document.getElementById('activation-key').value='';
    document.getElementById('product-title').value='';
    this.hideResults();
    this.hideError();
  }

  showActivationScreen(){document.getElementById('activation-screen').classList.remove('hidden');document.getElementById('main-screen').classList.add('hidden');document.getElementById('activation-key').focus();}
  showMainScreen(){document.getElementById('activation-screen').classList.add('hidden');document.getElementById('main-screen').classList.remove('hidden');document.getElementById('product-title').focus();}
  displayResults(data){
    const titleResult=document.getElementById('title-result');
    const tagsResult=document.getElementById('tags-result');
    const tipsResult=document.getElementById('tips-result');
    if(data.keyword_suggestions){
      titleResult.textContent = `SEO Score: ${data.seo_score||'N/A'}/100\nTitle Analysis:\n- Score: ${data.title_analysis?.score||'N/A'}\n- Strengths: ${(data.title_analysis?.strengths||[]).join(', ')}\n- Improvements: ${(data.title_analysis?.improvements||[]).join(', ')}`;
      const allTags = [...(data.keyword_suggestions.primary||[]), ...(data.keyword_suggestions.long_tail||[]), ...(data.keyword_suggestions.trending||[])];
      tagsResult.textContent = allTags.join(', ');
      tipsResult.textContent = (data.optimization_tips||[]).join('\n\n');
    } else {titleResult.textContent=JSON.stringify(data,null,2);}
    document.getElementById('results-section').classList.remove('hidden');
  }

  showErrorSection(msg){const e=document.getElementById('error-section');document.getElementById('error-message').textContent=msg;e.classList.remove('hidden');}
  hideResults(){document.getElementById('results-section').classList.add('hidden');}
  hideError(){document.getElementById('error-section').classList.add('hidden');}
  setButtonLoading(btn,loading){if(loading){btn.classList.add('loading'); btn.disabled=true;} else {btn.classList.remove('loading'); btn.disabled=false;}}
}

document.addEventListener('DOMContentLoaded', ()=>{new EtsySEOAssistant();});
</script>

</body>
</html>
